<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–û—Ç—á–µ—Ç Ultimate File Recovery</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .status {
            display: inline-block;
            padding: 10px 30px;

            background: {
                % if context.success %
            }

            #28a745 {
                % else %
            }

            #dc3545 {
                % endif %
            }

            ;
            color: white;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2em;
            margin-top: 20px;
        }

        .section {
            padding: 30px 40px;
            border-bottom: 1px solid #eee;
        }

        .section:last-child {
            border-bottom: none;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-left: 5px solid #667eea;
            padding-left: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .file-list {
            list-style: none;
        }

        .file-item {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .file-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
            transition: all 0.3s;
        }

        .file-name {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1em;
        }

        .file-meta {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin: 20px 0;
        }

        .failure-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .failure-box h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .failure-box ul {
            list-style-position: inside;
            color: #856404;
        }

        .cluster-card {
            background: #e7f3ff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            border-left: 4px solid #2196F3;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px;
            text-align: center;
            color: #666;
            font-size: 0.9em;
        }

        .badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            margin: 0 5px;
        }

        .badge-success {
            background: #28a745;
            color: white;
        }

        .badge-warning {
            background: #ffc107;
            color: #333;
        }

        .badge-danger {
            background: #dc3545;
            color: white;
        }

        .badge-info {
            background: #17a2b8;
            color: white;
        }

        .configuration-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .config-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            border-left: 3px solid #667eea;
        }

        .config-label {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .config-value {
            color: #333;
            font-family: 'Courier New', monospace;
        }

        .user-guide {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .user-guide h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .user-guide p,
        .user-guide ul {
            color: #444;
            margin-bottom: 10px;
        }

        .user-guide code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>{% if context.success %}‚úÖ{% else %}‚ùå{% endif %} –û—Ç—á–µ—Ç Ultimate File Recovery</h1>
            <p>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–æ: {{ context.metadata.timestamp }}</p>
            <div class="status">{% if context.success %}–£–°–ü–ï–®–ù–û{% else %}–§–ê–ô–õ–´ –ù–ï –ù–ê–ô–î–ï–ù–´{% endif %}</div>
        </div>

        <div class="section">
            <h2>üìò –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ (–ö–∞–∫ —á–∏—Ç–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)</h2>
            <div class="user-guide">
                <h3>üîç –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</h3>
                <p>–°–∏—Å—Ç–µ–º–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å—ã—Ä—ã—Ö —Å–µ–∫—Ç–æ—Ä–æ–≤ –¥–∏—Å–∫–∞. –í –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞, –≤—ã —É–≤–∏–¥–∏—Ç–µ
                    —Ä–∞–∑–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:</p>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li><strong>TXT/UNKNOWN</strong>: –≠—Ç–æ —Å—ã—Ä—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã.
                        <ul>
                            <li><code>_raw.bin</code>: –¢–æ—á–Ω—ã–µ –±–∞–π—Ç—ã —Å –¥–∏—Å–∫–∞ (–º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º—É—Å–æ—Ä).
                            </li>
                            <li><code>_clean.txt</code>: –ß–∏—Ç–∞–µ–º–∞—è, –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è.</li>
                        </ul>
                    </li>
                    <li><strong>JSON/CSV/HTML</strong>: –í–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π.</li>
                    <li><strong>.json (metadata)</strong>: –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –µ—Å—Ç—å JSON —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏ –∏
                        <strong>–Ω–∞–π–¥–µ–Ω–Ω—ã–º–∏ YouTube —Å—Å—ã–ª–∫–∞–º–∏</strong>.
                    </li>
                </ul>
                <p style="margin-top: 10px;"><strong>–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ <code>.json</code> —Ñ–∞–π–ª, –µ—Å–ª–∏ –±–∏–Ω–∞—Ä–Ω—ã–π —Ñ–∞–π–ª
                        –≤—ã–≥–ª—è–¥–∏—Ç –Ω–µ—á–∏—Ç–∞–µ–º—ã–º!</strong></p>
            </div>
        </div>

        <div class="section">
            <h2>üìä –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <div class="configuration-grid">
                <div class="config-item">
                    <div class="config-label">–§–∞–π–ª –æ–±—Ä–∞–∑–∞</div>
                    <div class="config-value">{{ context.metadata.image_path }}</div>
                </div>
                <div class="config-item">
                    <div class="config-label">–ü–∞–ø–∫–∞ –≤—ã–≤–æ–¥–∞</div>
                    <div class="config-value">{{ context.metadata.output_dir }}</div>
                </div>
                <div class="config-item">
                    <div class="config-label">–û–±—Ä–∞—Ç–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ</div>
                    <div class="config-value">{% if context.scan_results.reverse_scan %}–í–∫–ª—é—á–µ–Ω–æ{% else %}–í—ã–∫–ª—é—á–µ–Ω–æ{%
                        endif %}</div>
                </div>
                <div class="config-item">
                    <div class="config-label">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ exFAT</div>
                    <div class="config-value">{% if context.scan_results.exfat_enabled %}–í–∫–ª—é—á–µ–Ω–æ{% else %}–í—ã–∫–ª—é—á–µ–Ω–æ{%
                        endif %}</div>
                </div>
                <div class="config-item">
                    <div class="config-label">NVMe –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è</div>
                    <div class="config-value">{% if context.scan_results.nvme_optimization %}–í–∫–ª—é—á–µ–Ω–æ{% else
                        %}–í—ã–∫–ª—é—á–µ–Ω–æ{%
                        endif %}</div>
                </div>
                <div class="config-item">
                    <div class="config-label">–í–µ—Ä—Å–∏—è —É—Ç–∏–ª–∏—Ç—ã</div>
                    <div class="config-value">{{ context.metadata.version }}</div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">–†–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞</div>
                    <div class="stat-value">{{ "{:.1}"|format(context.scan_results.image_size_mb) }} MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ</div>
                    <div class="stat-value">{{ "{:.1}"|format(context.scan_results.bytes_scanned_mb) }} MB</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–ö–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –Ω–∞–π–¥–µ–Ω–æ</div>
                    <div class="stat-value">{{ context.scan_results.candidates_found }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–§–∞–π–ª–æ–≤ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</div>
                    <div class="stat-value">{{ context.recovered_files.len() }}</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–í—Ä–µ–º—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>
                    <div class="stat-value">{{ "{:.1}"|format(context.scan_results.scan_time_sec) }}s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–°—Ä. –°–∫–æ—Ä–æ—Å—Ç—å</div>
                    <div class="stat-value">{{ "{:.1}"|format(context.scan_results.avg_speed_mbps) }} MB/s</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                    <div class="stat-value">{{ "{:.1}"|format(stats.success_rate) }}%</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">–≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</div>
                    <div class="stat-value">{{ "{:.1}"|format(stats.efficiency_score) }}</div>
                </div>
            </div>
        </div>

        {% if !context.clusters.is_empty() %}
        <div class="section">
            <h2>üó∫Ô∏è –ö–ª–∞—Å—Ç–µ—Ä—ã –¥–∞–Ω–Ω—ã—Ö</h2>
            <p>–ù–∞–π–¥–µ–Ω—ã –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö –≤ —Å–ª–µ–¥—É—é—â–∏—Ö –æ–±–ª–∞—Å—Ç—è—Ö:</p>
            {% for cluster in context.clusters %}
            <div class="cluster-card">
                <strong>–ö–ª–∞—Å—Ç–µ—Ä #{{ cluster.id }}</strong><br>
                –°–º–µ—â–µ–Ω–∏–µ: {{ cluster.start_offset_hex }} - {{ cluster.end_offset_hex }}<br>
                –†–∞–∑–º–µ—Ä: {{ cluster.size_kb }} KB<br>
                –°—Å—ã–ª–∫–∏: {{ cluster.link_count }}<br>
                –ü–ª–æ—Ç–Ω–æ—Å—Ç—å: {{ "{:.2}"|format(cluster.density) }} —Å—Å—ã–ª–æ–∫/KB<br>
                –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {{ "{:.1}"|format(cluster.confidence * 100.0) }}%
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% if !context.recovered_files.is_empty() %}
        <div class="section">
            <h2>‚úÖ –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã</h2>
            <ul class="file-list">
                {% for file in context.recovered_files %}
                <li class="file-item">
                    <div class="file-name">{{ file.filename }}</div>
                    <div class="file-meta">
                        <span
                            class="badge {% if file.confidence >= 0.8 %}badge-success{% else if file.confidence >= 0.5 %}badge-warning{% else %}badge-danger{% endif %}">
                            –£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {{ "{:.0}"|format(file.confidence * 100.0) }}%
                        </span>
                        <span class="badge badge-info">–¢–∏–ø: {{ file.file_type|upper }}</span>
                        <span class="badge badge-info">–°—Å—ã–ª–∫–∏: {{ file.links.len() }}</span>
                        <span class="badge badge-info">–†–∞–∑–º–µ—Ä: {{ file.size_kb }} KB</span>
                    </div>
                    <div class="file-meta" style="margin-top: 10px;">
                        SHA256: <code>{{ file.sha256 }}</code><br>
                        –°–º–µ—â–µ–Ω–∏–µ: {{ format!("0x{:X}", file.start_offset) }} - {{ format!("0x{:X}", file.end_offset) }}
                    </div>
                    {% if !file.links.is_empty() %}
                    <div class="file-meta" style="margin-top: 5px;">
                        <strong>–ò–∑–≤–ª–µ—á–µ–Ω–Ω—ã–µ —Å—Å—ã–ª–∫–∏:</strong>
                        {% for link in file.links %}
                        <div><a href="{{ link }}" target="_blank">{{ link }}</a></div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if !context.success && !context.failure_reasons.is_empty() %}
        <div class="section">
            <div class="failure-box">
                <h3>‚ùå –ü–æ—á–µ–º—É —Ñ–∞–π–ª—ã –Ω–µ –±—ã–ª–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã</h3>
                <ul>
                    {% for reason in context.failure_reasons %}
                    <li>{{ reason }}</li>
                    {% endfor %}
                </ul>
                <p style="margin-top: 15px; font-weight: bold;">
                    –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
                </p>
                <ul>
                    <li>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã —Ä–∞–∑–º–µ—Ä–æ–≤ (--target-size-min/max)</li>
                    <li>–í–∫–ª—é—á–∏—Ç–µ –æ–±—Ä–∞—Ç–Ω–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (--reverse)</li>
                    <li>–û—Ç–∫–ª—é—á–∏—Ç–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (--skip-metadata)</li>
                    <li>–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –æ–±—Ä–∞–∑–∞ –¥–∏—Å–∫–∞</li>
                </ul>
            </div>
        </div>
        {% endif %}

        {% if !context.recovered_files.is_empty() %}
        <div class="section">
            <h2>üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è</h2>
            <div class="chart-container">
                <canvas id="recoveryChart"></canvas>
            </div>
        </div>

        <script>
            const ctx = document.getElementById('recoveryChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['–ö–∞–Ω–¥–∏–¥–∞—Ç—ã', '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ', '–û—Ç–∫–ª–æ–Ω–µ–Ω–æ', '–£—Å–ø–µ—à–Ω–æ—Å—Ç—å'],
                    datasets: [{
                        label: '–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è',
                        data: [
                            {{ context.scan_results.candidates_found }},
                    {{ context.recovered_files.len() }}, 
                            {{ stats.candidates_rejected }},
                {{ stats.success_rate }}
                        ],
                backgroundColor: [
                'rgba(54, 162, 235, 0.8)',
                'rgba(75, 192, 192, 0.8)',
                'rgba(255, 99, 132, 0.8)',
                'rgba(255, 206, 86, 0.8)'
            ],
                borderColor: [
                'rgba(54, 162, 235, 1)',
                'rgba(75, 192, 192, 1)',
                'rgba(255, 99, 132, 1)',
                'rgba(255, 206, 86, 1)'
            ],
                borderWidth: 2
                    }]
                },
                options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
            });
        </script>
        {% endif %}

        <div class="footer">
            <p><strong>Ultimate File Recovery v{{ context.metadata.version }}</strong> | –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ | –ù–∞ –±–∞–∑–µ –ò–ò</p>
            <p>–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Rust | SIMD –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è | TUI –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</p>
        </div>
    </div>
</body>

</html>